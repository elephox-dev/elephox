#!/usr/bin/php
<?php
declare(strict_types=1);

use Elephox\Configuration\Json\JsonFileConfigurationSource;
use Elephox\Host\ConsoleApplication;
use Whoops\Handler\PlainTextHandler;
use Whoops\Run as WhoopsRun;
use Whoops\RunInterface as WhoopsRunInterface;

require_once dirname(__DIR__) . '/bootstrap.php';

$builder = ConsoleApplication::createBuilder();
$builder->configuration->add(new JsonFileConfigurationSource('config.json'));
$builder->configuration->add(new JsonFileConfigurationSource('config.' . $builder->environment->getEnvironmentName() . '.json', true));
$builder->configuration->add(new JsonFileConfigurationSource('config.local.json', true));
$app = $builder->build();
$app->services->addSingleton(WhoopsRunInterface::class, WhoopsRun::class, implementationFactory: function () {
    $whoops = new WhoopsRun();
    $whoops->pushHandler(new PlainTextHandler());
    return $whoops;
});
$app->handle();
