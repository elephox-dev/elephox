#!/usr/bin/php
<?php
declare(strict_types=1);

define('APP_ROOT', dirname(__DIR__));
require_once APP_ROOT . '/vendor/autoload.php';

use Elephox\Console\ConsoleApplication;
use Whoops\Handler\PlainTextHandler;
use Whoops\Run as WhoopsRun;
use Whoops\RunInterface as WhoopsRunInterface;

$builder = ConsoleApplication::createBuilder();
$builder->services->addSingleton(WhoopsRunInterface::class, WhoopsRun::class, implementationFactory: function () {
    $whoops = new WhoopsRun();
    $whoops->pushHandler(new PlainTextHandler());
    return $whoops;
});

$app = $builder->build();
try {
    $app->handle();
} catch (Throwable $e) {
    $app->services->get(WhoopsRunInterface::class)->handleException($e);
}
